function [lny,sigma,phi,tau] = AkkarBoomer2010(To,M,Rjb,media,SOF,adjfun)
% Syntax : AkkarBoomer2010 media SOF                                        

%Akkar, S. and Bommer, J.J., 2010. Empirical prediction equations for peak ground velocity
%derived from strongmotion records from Europe and the Middle East.
%Seismological Research Letters, 81, 195-206

st = dbstack;
[isadmisible,units] = isIMadmisible(To,st(1).name,[0 3],[nan nan],[nan nan],[nan nan]);
if isadmisible==0
    lny   = nan(size(M));
    sigma = nan(size(M));
    tau   = nan(size(M));
    phi   = nan(size(M));
    return
end

if To~=-1
    To=max(To,0.01); % PGA associated to To=0.01s
end

period  = round([-1 0.01 0.05:0.05:3]*100)/100;
T_lo    = max(period(period<=To));              % Identify the period that is below for the later interpolation
T_hi    = min(period(period>=To));              % Identify the period that is above for the later interpolation
index   = find(abs((period - T_lo)) < 1e-6);    % Identify the period from the ones evaluated in the paper

if isnumeric(media)
    if media>=750                    , media='rock';
    elseif and(360<=media,media<750) , media='stiff';
    elseif media<360                 , media='soft';
    end
end

if T_lo==T_hi
    [log10y,sigma,phi,tau] = gmpe(index,M,Rjb,media,SOF);
else
    [log10y_lo,~,phi_lo,tau_lo] = gmpe(index,M,Rjb,media,SOF);
    [log10y_hi,~,phi_hi,tau_hi] = gmpe(index+1,M,Rjb,media,SOF);
    x           = log([T_lo;T_hi]);
    Y_sa        = [log10y_lo,log10y_hi]';
    Y_phi       = [phi_lo,phi_hi]';
    Y_tau       = [tau_lo,tau_hi]';
    log10y      = interp1(x,Y_sa,log(To))';
    phi         = interp1(x,Y_phi,log(To))';
    tau         = interp1(x,Y_tau,log(To))';
    sigma       = sqrt(phi.^2+tau.^2);
end

% log base conversion
lny   = log10y * log(10);
sigma = sigma  * log(10);
phi   = phi    * log(10);
tau   = tau    * log(10);

% unit convertion
lny  = lny+log(units);

% modifier
if exist('adjfun','var')
    SF  = feval(adjfun,To); 
    lny = lny+log(SF);
end


function [log10y,sigma,phi,tau] = gmpe(index,Mw,Rrup,media,SOF)

COEFF=  [
    -2.12833    1.21448 -0.08137    -2.46942    0.22349     6.41443     0.20354     0.08484     -0.05856    0.01305     0.2562      0.1083
    1.04159     0.91333	-0.08140	-2.92728	0.28120		7.86638		0.08753		0.01527		-0.04189	0.08015		0.2610		0.0994
    2.11528		0.72571	-0.07351	-3.33201	0.33534		7.74734		0.04707		-0.02426	-0.04260	0.08649		0.2720		0.1142
    2.11994		0.75179	-0.07448	-3.10538	0.30253		8.21405		0.02667		-0.00062	-0.04906	0.07910		0.2728		0.1167
    1.64489		0.83683	-0.07544	-2.75848	0.25490		8.31786		0.02578		0.01703		-0.04184	0.07840		0.2788		0.1192
    0.92065		0.96815	-0.07903	-2.49264	0.21790		8.21914		0.06557		0.02105		-0.02098	0.08438		0.2821		0.1081
    0.13978		1.13068	-0.08761	-2.33824	0.20089		7.20688		0.09810		0.03919		-0.04853	0.08577		0.2871		0.0990
    -0.84006	1.37439	-0.10349	-2.19123	0.18139		6.54299		0.12847		0.04340		-0.05554	0.09221		0.2902		0.0976
    -1.32207	1.47055	-0.10873	-2.12993	0.17485		6.24751		0.16213		0.06695		-0.04722	0.09003		0.2983		0.1054
    -1.70320	1.55930	-0.11388	-2.12718	0.17137		6.57173		0.21222		0.09201		-0.05145	0.09903		0.2998		0.1101
    -1.97201	1.61645	-0.11742	-2.16619	0.17700		6.78082		0.24121		0.11675		-0.05202	0.09943		0.3037		0.1123
    -2.76925	1.83268	-0.13202	-2.12969	0.16877		7.17423		0.25944		0.13562		-0.04283	0.08579		0.3078		0.1163
    -3.51672	2.02523	-0.14495	-2.04211	0.15617		6.76170		0.26498		0.14446		-0.04259	0.06945		0.3070		0.1274
    -3.92759	2.08471	-0.14648	-1.88144	0.13621		6.10103		0.27718		0.15156		-0.03853	0.05932		0.3007		0.1430
    -4.49490	2.21154	-0.15522	-1.79031	0.12916		5.19135		0.28574		0.15239		-0.03423	0.05111		0.3004		0.1546
    -4.62925	2.21764	-0.15491	-1.79800	0.13495		4.46323		0.30348		0.15652		-0.04146	0.04661		0.2978		0.1626
    -4.95053	2.29142	-0.15983	-1.81321	0.13920		4.27945		0.31516		0.16333		-0.04050	0.04253		0.2973		0.1602
    -5.32863	2.38389	-0.16571	-1.77273	0.13273		4.37011		0.32153		0.17366		-0.03946	0.03373		0.2927		0.1584
    -5.75799	2.50635	-0.17479	-1.77068	0.13096		4.62192		0.33520		0.18480		-0.03786	0.02867		0.2917		0.1543
    -5.82689	2.50287	-0.17367	-1.76295	0.13059		4.65393		0.34849		0.19061		-0.02884	0.02475		0.2915		0.1521
    -5.90592	2.51405	-0.17417	-1.79854	0.13535		4.84540		0.35919		0.19411		-0.02209	0.02502		0.2912		0.1484
    -6.17066	2.58558	-0.17938	-1.80717	0.13599		4.97596		0.36619		0.19519		-0.02269	0.02121		0.2895		0.1483
    -6.60337	2.69584	-0.18646	-1.73843	0.12485		5.04489		0.37278		0.19461		-0.02613	0.01115		0.2888		0.1465
    -6.90379	2.77044	-0.19171	-1.71109	0.12227		5.00975		0.37756		0.19423		-0.02655	0.00140		0.2896		0.1427
    -6.96180	2.75857	-0.18890	-1.66588	0.11447		5.08902		0.38149		0.19402		-0.02088	0.00148		0.2871		0.1435
    -6.99236	2.73427	-0.18491	-1.59120	0.10265		5.03274		0.38120		0.19309		-0.01623	0.00413		0.2878		0.1439
    -6.74613	2.62375	-0.17392	-1.52886	0.09129		5.08347		0.38782		0.19392		-0.01826	0.00413		0.2863		0.1453
    -6.51719	2.51869	-0.16330	-1.46527	0.08005		5.14423		0.38862		0.19273		-0.01902	-0.00369	0.2869		0.1427
    -6.55821	2.52238	-0.16307	-1.48223	0.08173		5.29006		0.38677		0.19082		-0.01842	-0.00897	0.2885		0.1428
    -6.61945	2.52611	-0.16274	-1.48257	0.08213		5.33490		0.38625		0.19285		-0.01607	-0.00876	0.2875		0.1458
    -6.62737	2.49858	-0.15910	-1.43310	0.07577		5.19412		0.38285		0.19161		-0.01288	-0.00564	0.2857		0.1477
    -6.71787	2.49486	-0.15689	-1.35301	0.06379		5.15750		0.37867		0.18812		-0.01208	-0.00215	0.2839		0.1468
    -6.80776	2.50291	-0.15629	-1.31227	0.05697		5.27441		0.37267		0.18568		-0.00845	-0.00047	0.2845		0.1450
    -6.83632	2.51009	-0.15676	-1.33260	0.05870		5.54539		0.36952		0.18149		-0.00533	-0.00006	0.2844		0.1457
    -6.88684	2.54048	-0.15995	-1.40931	0.06860		5.93828		0.36531		0.17617		-0.00852	-0.00301	0.2841		0.1503
    -6.94600	2.57151	-0.16294	-1.47676	0.07672		6.36599		0.35936		0.17301		-0.01204	-0.00744	0.2840		0.1537
    -7.09166	2.62938	-0.16794	-1.54037	0.08428		6.82292		0.35284		0.16945		-0.01386	-0.01387	0.2840		0.1558
    -7.22818	2.66824	-0.17057	-1.54273	0.08325		7.11603		0.34775		0.16743		-0.01402	-0.01492	0.2834		0.1582
    -7.29772	2.67565	-0.17004	-1.50936	0.07663		7.31928		0.34561		0.16730		-0.01526	-0.01192	0.2828		0.1592
    -7.35522	2.67749	-0.16934	-1.46988	0.07065		7.25988		0.34142		0.16325		-0.01563	-0.00703	0.2826		0.1611
    -7.40716	2.68206	-0.16906	-1.43816	0.06525		7.25344		0.33720		0.16171		-0.01848	-0.00351	0.2832		0.1642
    -7.50404	2.71004	-0.17130	-1.44395	0.06602		7.26059		0.33298		0.15839		-0.02258	-0.00486	0.2835		0.1657
    -7.55598	2.72737	-0.17291	-1.45794	0.06774		7.40320		0.33010		0.15496		-0.02626	-0.00731	0.2836		0.1665
    -7.53463	2.71709	-0.17221	-1.46662	0.06940		7.46168		0.32645		0.15337		-0.02920	-0.00871	0.2832		0.1663
    -7.50811	2.71035	-0.17212	-1.49679	0.07429		7.51273		0.32439		0.15264		-0.03484	-0.01225	0.2830		0.1661
    -8.09168	2.91159	-0.18920	-1.55644	0.08428		7.77062		0.31354		0.14430		-0.03985	-0.01927	0.2830		0.1627
    -8.11057	2.92087	-0.19044	-1.59537	0.09052		7.87702		0.30997		0.14430		-0.04155	-0.02322	0.2830		0.1627
    -8.16272	2.93325	-0.19155	-1.60461	0.09284		7.91753		0.30826		0.14412		-0.04238	-0.02626	0.2829		0.1633
    -7.94704	2.85328	-0.18539	-1.57428	0.09077		7.61956		0.32071		0.14321		-0.04963	-0.02342	0.2815		0.1632
    -7.96679	2.85363	-0.18561	-1.57833	0.09288		7.59643		0.31801		0.14301		-0.04910	-0.02570	0.2826		0.1645
    -7.97878	2.84900	-0.18527	-1.57728	0.09428		7.50338		0.31401		0.14324		-0.04812	-0.02643	0.2825		0.1665
    -7.88403	2.81817	-0.18320	-1.60381	0.09887		7.53947		0.31104		0.14332		-0.04710	-0.02769	0.2818		0.1681
    -7.68101	2.75720	-0.17905	-1.65212	0.10680		7.61893		0.30875		0.14343		-0.04607	-0.02819	0.2818		0.1688
    -7.72574	2.82043	-0.18717	-1.88782	0.14049		8.12248		0.31122		0.14255		-0.05106	-0.02966	0.2838		0.1741
    -7.53288	2.74824	-0.18142	-1.89525	0.14356		7.92236		0.30935		0.14223		-0.05024	-0.02930	0.2845		0.1759
    -7.41587	2.69012	-0.17632	-1.87041	0.14283		7.49999		0.30688		0.14074		-0.04887	-0.02963	0.2854		0.1772
    -7.34541	2.65352	-0.17313	-1.86079	0.14340		7.26668		0.30635		0.14052		-0.04743	-0.02919	0.2862		0.1783
    -7.24561	2.61028	-0.16951	-1.85612	0.14444		7.11861		0.30534		0.13923		-0.04731	-0.02751	0.2867		0.1794
    -7.07107	2.56123	-0.16616	-1.90422	0.15127		7.36277		0.30508		0.13933		-0.04522	-0.02776	0.2869		0.1788
    -6.99332	2.52699	-0.16303	-1.89704	0.15039		7.45038		0.30362		0.13776		-0.04203	-0.02615	0.2874		0.1784
    -6.95669	2.51006	-0.16142	-1.90132	0.15081		7.60234		0.29987		0.13584		-0.03863	-0.02487	0.2872		0.1783
    -6.92924	2.45899	-0.15513	-1.76801	0.13314		7.21950		0.29772		0.13198		-0.03855	-0.02469	0.2876		0.1785];

b1  = COEFF(index,1);
b2  = COEFF(index,2);
b3  = COEFF(index,3);
b4  = COEFF(index,4);
b5  = COEFF(index,5);
b6  = COEFF(index,6);
b7  = COEFF(index,7);
b8  = COEFF(index,8);
b9  = COEFF(index,9);
b10 = COEFF(index,10);
phi = COEFF(index,11);
tau = COEFF(index,12);


switch media
    case 'rock' ,  Ss=0;Sa=0;
    case 'stiff',  Ss=0;Sa=1;
    case 'soft' ,  Ss=1;Sa=0;
end


switch SOF
    case 'strike-slip',       Fn=0; Fr=0;
    case 'normal',            Fn=1; Fr=0;
    case 'normal-oblique',    Fn=1; Fr=0;
    case 'reverse',           Fn=0; Fr=1;
    case 'reverse-oblique',   Fn=0; Fr=1;
    case 'unspecified',       Fn=0; Fr=0;
end

log10y = b1 + b2*Mw + b3*Mw.^2 + (b4 + b5*Mw).*log10(sqrt(Rrup.^2+b6^2)) + b7*Ss + b8*Sa + b9*Fn + b10*Fr;
sigma  = sqrt(phi.^2+tau.^2);

