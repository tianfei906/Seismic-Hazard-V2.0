clearvars
clc
%% MR1,MR2,hazard curves
% MR1 Hazard
if 1
    BM1=[1	0.0201542993765741	0.0188286159391445	0.0196812164741545	0.021590689517821
1.26896100316792	0.0189428024366519	0.017098186405268	0.0190864045888925	0.0203401871582995
1.61026202756094	0.0179770675764006	0.0157564793521436	0.0184544186253915	0.019459311169872
2.04335971785694	0.0171401574456426	0.0146336353520855	0.017780494408485	0.0187743526411303
2.59294379740467	0.0163284140970216	0.0136210040707533	0.0169789600106932	0.0181664412340649
3.29034456231267	0.0154609536917106	0.0126637903393678	0.0159663605340239	0.0175292552816165
4.1753189365604	0.0145040323457277	0.011746188497039	0.01476597138404	0.0167630352313634
5.29831690628371	0.0134765874076307	0.0108745041523341	0.0135036940254702	0.0158053199522338
6.72335753649934	0.0124281176231564	0.010062457057214	0.0123129312865609	0.014662710681556
8.53167852417281	0.0114120585182501	0.0093206010662506	0.0112582571070692	0.0134191084565025
10.8263673387405	0.0104721737140305	0.0086500292564339	0.0103647075508751	0.0121803879971254
13.7382379588326	0.00964188521874641	0.00803985788718932	0.00969395124389786	0.0110050745882686
17.4332882219999	0.00893876898721629	0.00746810598193696	0.0093002766605246	0.00992920617137301
22.1221629107045	0.00835907944891246	0.00690576407842824	0.00913096136112032	0.0090281746238532
28.0721620394118	0.00788327328581544	0.00632348272316715	0.00906211667327263	0.00837774170623861
35.6224789026244	0.0074743106114661	0.00569938594887046	0.00898978658546364	0.00797525848797831
45.2035365636024	0.00707652069301303	0.00502560694927922	0.00883104831729604	0.00774727312533916
57.3615251044868	0.00662346458819823	0.00431109118198734	0.00847064514182201	0.00760037943509995
72.7895384398315	0.00604856652078128	0.00357949562160953	0.00776021885731355	0.00743634104866645
92.3670857187386	0.00530826503243126	0.00286313186255071	0.00663781278374944	0.00713233500610956
117.210229753348	0.00441496516753781	0.00219550273729532	0.00525452200502474	0.00654286267551025
148.735210729351	0.00344129979734765	0.00160501201312786	0.00386469200003359	0.00558935109459469
188.73918221351	0.00247486962179095	0.00111110227072194	0.00257196839106234	0.00438395477848325
239.502661998749	0.00159671723055441	0.000722598776605035	0.00140468373584568	0.00318576104730951
303.91953823132	0.000888711946259775	0.000437538727902299	0.000553634341254597	0.00215636813017572
385.662042116347	0.000406346407988015	0.00024433390347664	0.00014247241227408	0.00130603609394643
489.390091847749	0.000146150052989424	0.000124609720120194	2.25304523429276e-05	0.00066950845989017
621.016941891562	4.04469491768819e-05	5.7453289835314e-05	2.11555596438132e-06	0.00028422341807833
788.046281566991	8.55556102080428e-06	2.36903424524966e-05	1.15611172651819e-07	0.000100564077529569
1000	1.37814410324984e-06	8.63488126759902e-06	3.63164806787727e-09	2.99203371880694e-05];

    BU1=[1	1	0.0724546875199063	0.907550582147458	0.102375424437727
1.26896100316792	1	0.0628901418521736	0.759100647685408	0.0894658807701036
1.61026202756094	1	0.0552355877120535	0.582209060621254	0.0779175703690911
2.04335971785694	1	0.0471600659510009	0.40289214669022	0.0676269707063803
2.59294379740467	1	0.0396178157355609	0.24825192660856	0.0584919244700525
3.29034456231267	1	0.0340928073727792	0.1348008970932	0.0504113756400218
4.1753189365604	1	0.0294639900350806	0.063994202217047	0.0432875346053501
5.29831690628371	1	0.0245864011292183	0.0264007029931559	0.0370278731160007
6.72335753649934	1	0.0203174432452306	0.00942162920647567	0.0315450384750462
8.53167852417281	1	0.017260838565919	0.00289834864359144	0.0267567847231548
10.8263673387405	1	0.0145574701404839	0.000766507590680594	0.0225871526480959
13.7382379588326	1	0.0117596761384331	0.000173904091596638	0.0189671964738539
17.4332882219999	1	0.00946925526499864	3.37917549002101e-05	0.0158344946559925
22.1221629107045	1	0.00784897486428135	5.61623905210876e-06	0.0131327640674069
28.0721620394118	1	0.00635768077071631	7.97539074767825e-07	0.0108119733563014
35.6224789026244	1	0.00487607535085008	9.66837087819522e-08	0.00882795651578286
45.2035365636024	1	0.00374940700706483	9.99861183071617e-09	0.00714144067203575
57.3615251044868	1	0.002972954972758	8.81563883504034e-10	0.00571733606723145
72.7895384398315	1	0.00226132440681609	6.62338309897474e-11	0.00452428995822815
92.3670857187386	1	0.00160027981929097	4.23872354589703e-12	0.00353390511212763
117.210229753348	1	0.0011384967524349	2.30939955662739e-13	0.00271984277031817
148.735210729351	1	0.000833320697915402	1.06974911342413e-14	0.0020575244179407
188.73918221351	1	0.000552833702019245	3.77558510620282e-16	0.0015244603265238
239.502661998749	1	0.000293954145998081	NaN	0.00110070485096683
303.91953823132	1	0.00012159948136283	NaN	0.000769178135704365
385.662042116347	1	4.16187432811142e-05	NaN	0.000515714625736041
489.390091847749	1	1.3192834102086e-05	NaN	0.000328501030317174
621.016941891562	1	4.07469222392379e-06	NaN	0.000196853175796378
788.046281566991	1	1.18205199252894e-06	NaN	0.000110035773322901
1000	1	3.12363204469732e-07	NaN	5.70166401363023e-05];
end
% MR2 Hazard
if 2
    BM2=[1	1	0.00523212329949765	0.00538333869539235	0.0058351847205713
1.26896100316792	1	0.00479239937660993	0.00525241231152156	0.00551808583605379
1.61026202756094	1	0.00445031266003246	0.00510930428284154	0.00530155812075186
2.04335971785694	1	0.00416208633468605	0.00495145919012816	0.00514004793743002
2.59294379740467	1	0.00389875613992129	0.0047567514731612	0.00500101401167468
3.29034456231267	1	0.00364526452298155	0.00450253066624558	0.00485610906828405
4.1753189365604	1	0.00339722652253869	0.00419171595001595	0.00467877718002883
5.29831690628371	1	0.00315679433710032	0.00385403290539822	0.00445019272280672
6.72335753649934	1	0.00292877371456308	0.00352354178737773	0.00416743237772098
8.53167852417281	1	0.00271758395514076	0.00321870702913255	0.00384786819143946
10.8263673387405	1	0.00252520403030936	0.00295063293494688	0.00351699951490089
13.7382379588326	1	0.00235008137497224	0.00274406253416159	0.00319032897394161
17.4332882219999	1	0.00218701822351031	0.0026211593589922	0.00287961511763964
22.1221629107045	1	0.00202808695644432	0.00256883921366691	0.00261050645988267
28.0721620394118	1	0.00186449201202423	0.00255026966920124	0.00241083992445731
35.6224789026244	1	0.00168898006274966	0.00253499420893199	0.0022849035289524
45.2035365636024	1	0.00149806779632388	0.00250069114565091	0.00221376730611858
57.3615251044868	1	0.0012932667551665	0.00241654787901485	0.00217131455178711
72.7895384398315	1	0.00108081574340284	0.00223910984921218	0.00213052920234503
92.3670857187386	1	0.000870075611536413	0.00194208533364378	0.00205781065364488
117.210229753348	1	0.00067129881378147	0.00155683233413166	0.00191006588561008
148.735210729351	1	0.000493592003598283	0.00115372342619948	0.00165609964487339
188.73918221351	1	0.000343545730837662	0.000770540292421614	0.00131686668762371
239.502661998749	1	0.000224548569140404	0.000422279526632913	0.000965788417789726
303.91953823132	1	0.000136605851766598	0.000167210978574983	0.000657937278830612
385.662042116347	1	7.66206323988082e-05	4.32503012742175e-05	0.000401551556716491
489.390091847749	1	3.92370191470309e-05	6.87234250896089e-06	0.000207769593346872
621.016941891562	1	1.81596364124754e-05	6.47969327927837e-07	8.90126798954085e-05
788.046281566991	1	7.51388337638846e-06	3.5531926468804e-08	3.1741264022072e-05
1000	1	2.74720107473855e-06	1.11925191215074e-09	9.50334549622923e-06];    
    
    BU2=[1	1	0.0182385361750004	0.167442519658365	0.0246648327291756
1.26896100316792	1	0.0160923524889463	0.14005359879995	0.0218753178227601
1.61026202756094	1	0.0143239099422627	0.107417210672356	0.0193383898958614
2.04335971785694	1	0.0124165402619275	0.0743333512417018	0.0170391317033624
2.59294379740467	1	0.010620260219203	0.0458023265248998	0.0149622478929895
3.29034456231267	1	0.00928349073779001	0.0248706819272647	0.0130920376120868
4.1753189365604	1	0.00812563852566785	0.0118068906279521	0.0114129090042496
5.29831690628371	1	0.00688107148341521	0.0048709133318675	0.00990977985115996
6.72335753649934	1	0.00578268462175867	0.0017382847464945	0.00856804033404919
8.53167852417281	1	0.00498066231224166	0.000534743527554151	0.00737360944297326
10.8263673387405	1	0.0042472802781078	0.000141420175189715	0.0063132703262935
13.7382379588326	1	0.00347608137887464	3.2085197066304e-05	0.0053748397639043
17.4332882219999	1	0.00283970427919645	6.23455782572539e-06	0.00454707097052217
22.1221629107045	1	0.00238009432771401	1.03619262263445e-06	0.00381963807427102
28.0721620394118	1	0.0019449402638854	1.47145464762016e-07	0.0031832265626417
35.6224789026244	1	0.00150769457555308	1.78380843192884e-08	0.00262945418260576
45.2035365636024	1	0.00117294981648801	1.84473768289537e-09	0.00215065567748895
57.3615251044868	1	0.000938028743936819	1.6264798987231e-10	0.00173976495234265
72.7895384398315	1	0.000718151991219048	1.22201007477814e-11	0.00139024702993863
92.3670857187386	1	0.000512366000795494	7.82041865898907e-13	0.00109590752461828
117.210229753348	1	0.000367859995449097	4.2608278620086e-14	0.000850680736724002
148.735210729351	1	0.000270940630384853	1.9736804810394e-15	0.000648613499937383
188.73918221351	1	0.000180405787063224	6.96593110955084e-17	0.00048403341415991
239.502661998749	1	9.62956046989625e-05	NaN	0.000351747923407009
303.91953823132	1	4.00653725140657e-05	NaN	0.000247204268065923
385.662042116347	1	1.38275446999395e-05	NaN	0.000166559875708623
489.390091847749	1	4.42405014390471e-06	NaN	0.000106541216029439
621.016941891562	1	1.37630987349211e-06	NaN	6.40750251812296e-05
788.046281566991	1	4.0125028369416e-07	NaN	3.59312894087193e-05
1000	1	1.06439131668846e-07	NaN	1.86745782826409e-05];
end

% data processing
s       = BM1(:,1);
BM1(:,2)=[];
BM2(:,2)=[];
BU1(:,2)=[];
BU2(:,2)=[];

%% Plotting
close all
f=figure;
f.Position=[209   363   749   303];
subplot(1,2,1)
hold on
loglog(s,BM1(:,2)              ,'color',[    0        0.447        0.741])
loglog(s,BM1(:,3),'--'         ,'color',[    0        0.447        0.741])
loglog(s,BM1(:,4),'linewidth',2,'color',[    0        0.447        0.741])
loglog(s,BU1(:,2),'color',[ 0.85        0.325        0.098])
loglog(s,BU1(:,4),'color',[ 0.85        0.325        0.098],'linewidth',2)
set(gca,'xscale','log','yscale','log','xlim',[1 1300],'ylim',[1e-5 1e0],'xtick',[1 10 100 1000],'ytick',10.^[-5:0])
xlabel('Settlement (mm)'); ylabel('MRE')
text(400,0.5,'MR1','fontweight','bold')

L=legend('Ds (BM2017)','Dv (BM2017)','LIBS (BM2017)','Ds (B2018)','LIBS (B2018)');
L.Box='off'; L.Title.String='Settlement Component';L.Location='SouthWest';
text(0.2,1,'(a)')

subplot(1,2,2)
hold on
loglog(s,BM2(:,2)              ,'color',[    0        0.447        0.741])
loglog(s,BM2(:,3),'--'         ,'color',[    0        0.447        0.741])
loglog(s,BM2(:,4),'linewidth',2,'color',[    0        0.447        0.741])
loglog(s,BU2(:,2),'color',[ 0.85        0.325        0.098])
loglog(s,BU2(:,4),'color',[ 0.85        0.325        0.098],'linewidth',2)
set(gca,'xscale','log','yscale','log','xlim',[1 1300],'ylim',[1e-5 1e0],'xtick',[1 10 100 1000],'ytick',10.^[-5:0])
xlabel('Settlement (mm)');
text(400,0.5,'MR2','fontweight','bold')
text(0.2,1,'(b)')


%% PSEUDO-PROBABILISTIC APPROACH FOR BRAY AND MACEDO
clc
param =loadsiteLIBS('CPTZ1B3.txt','');
param.Q=param.Q(1);

%        M   Rrup   CAV       CAVdp       PGA         SA1
% RetPeriod = 475;
% data1 = [6.4500	23.3000	0.6651	1.3992	0.4616	0.2592
% 6.2500	23.3000	0.4037	0.7336	0.2892	0.1820]; %first submission
% data1=[6.7500	24.5000	0.568	1.109	0.324	0.229
%       6.9500	22.8000	0.337	0.578	0.194	0.175];

RetPeriod = 2475;
% data1=[6.6500	28.1000	1.1225	2.7584	0.7322	0.4507
% 6.4500	23.3000	0.8011	1.7311	0.5206	0.2766]; %first dubmission
data1=[6.6500	26.9000	0.953	1.992	0.538	0.326
       6.8500	23.7000	0.684	1.338	0.379	0.259];


M     = data1(:,1);
R     = data1(:,2);
CAV   = data1(:,3)*980.66;
CAVdp = data1(:,4)*980.66;
PGA   = data1(:,5);
SA1   = data1(:,6);

im3   = [CAVdp,PGA,SA1];
D     = zeros (2,14);


% column 1
for i=1:2
    D(i,1) =exp(pseudoProbaBMDs(param,im3(i,:),M(i),'BI14'))*0.5 +...
        exp(pseudoProbaBMDs(param,im3(i,:),M(i),'R15'))*0.5;
end

%column 2
for i=1:2
    D(i,2) = exp(libs_Juang2013Dv(param,PGA(i),M(i)));
end

%column 3
for i=1:2
    D(i,3) = libs_Hutabarat2020De(param,PGA(i),M(i),'BI14');
end

% column 4
for i=1:2
    D(i,4) = exp(pseudoProbaBM(param,im3(i,1),im3(i,2),im3(i,3),M(i),'BI14'))*0.5+...
        exp(pseudoProbaBM(param,im3(i,1),im3(i,2),im3(i,3),M(i),'R15')) *0.5+D(i,3);
end

% column 5
for i=1:2
    D(i,5) = exp(libs_Bullock2018Ds(param,CAV(i)));
end

% column 6
for i=1:2
    D(i,6) = D(i,5)*(exp(libs_Bullock2018Dv(param,CAV(i)))-1);
end

% column 7
for i=1:2
    D(i,7) = exp(libs_Bullock2018(param,CAV(i)));
end

% colum 8
D(1,8)= robustinterp(BM1(:,2),s,1/RetPeriod,'loglog');
D(2,8)= robustinterp(BM2(:,2),s,1/RetPeriod,'loglog');

% colum 9
D(1,9)= robustinterp(BM1(:,3),s,1/RetPeriod,'loglog');
D(2,9)= robustinterp(BM2(:,3),s,1/RetPeriod,'loglog');

% column 10
D(:,10)=D(:,3);

% colum 11  Ds + Dv +De
D(1,11)= robustinterp(BM1(:,4),s,1/RetPeriod,'loglog') + D(1,10);
D(2,11)= robustinterp(BM2(:,4),s,1/RetPeriod,'loglog') + D(2,10);

% colum 12
D(1,12)= robustinterp(BU1(:,2),s,1/RetPeriod,'loglog');
D(2,12)= robustinterp(BU2(:,2),s,1/RetPeriod,'loglog');


% colum 13
D(1,13)= robustinterp(BU1(:,3),s,1/RetPeriod,'loglog');
D(2,13)= robustinterp(BU2(:,3),s,1/RetPeriod,'loglog');

% colum 14
D(1,14)= robustinterp(BU1(:,4),s,1/RetPeriod,'loglog');
D(2,14)= robustinterp(BU2(:,4),s,1/RetPeriod,'loglog');

